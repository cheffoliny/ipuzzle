<?xml version="1.0" encoding="utf-8"?>
<mx:Application
	xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:rpc="net.telepol.rpc.*"
	layout="absolute" initialize="initializeHandler( event )"
	applicationComplete="loadApp()"> 
	<mx:Script>
		<![CDATA[
			import net.telepol.res.Resources;
			import net.telepol.log.LogViewer;
			
			protected var logViewer:LogViewer;
			
			[Bindable]
			public var resources:Resources = Resources.instance;
			
			protected function initializeHandler( event:Event ) : void {
				logViewer = new LogViewer();
				logViewer.initializeHandler( event );
			}

			protected var HTML_params:Object = {};
			private function readQueryString():Object {
				var _queryString:String;
				var _params:Object = {};
				try {
					_queryString = ExternalInterface.call("window.location.search.substring", 1);
					if(_queryString) {				
						var params:Array = _queryString.split('&');
						var length:uint = params.length;
					
						for (var i:uint=0,index:int=-1; i<length; i++) {
							var kvPair:String = params[i];
							if((index = kvPair.indexOf("=")) > 0) {
								var key:String = kvPair.substring(0,index);
								var value:String = kvPair.substring(index+1);
								_params[key] = value;
							}
						}
					}
				} catch(e:Error) {
					trace("Some error occured. ExternalInterface doesn't work in Standalone player.");
				}
				return _params;
			}
			
			private function loadApp():void {
				HTML_params = readQueryString();
			}
		]]>
	</mx:Script>
	<rpc:AMFChannelExt id="afmChannel"/>
	<mx:ChannelSet id="afmChannelSet" channels="{[afmChannel]}"/>
	<rpc:AMFServiceExt id="amfService" channelSet="{afmChannelSet}"/>
</mx:Application>
